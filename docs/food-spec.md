# 食べ物仕様書

## 概要

フィールドに配置される食べ物アイテム。取得するとエネルギー回復や一時バフが得られる。  
種類ごとに色が異なり、上方向に伸びるビームで遠くからでも視認可能。

---

## 実装済みの種類（3種類）

| typeId | 名前 | 効果 | 持続時間 | 出現率 |
|--------|------|------|----------|--------|
| `energy` | エネルギー | エネルギー即時 +25 | — | 85% |
| `speedUp` | 速度Up | 速度倍率 ×1.2 | 30秒 | 10% |
| `recoveryCooldownShort` | 回復短縮 | 回復クールダウン ×0.5 | 45秒 | 5% |

---

## 見た目（色）

| typeId | メッシュ色 | ビーム色 |
|--------|-----------|----------|
| `energy` | 黄 `#fbbf24` | `#ffdd44` |
| `speedUp` | 緑 `#22c55e` | `#4ade80` |
| `recoveryCooldownShort` | 青 `#3b82f6` | `#60a5fa` |

- メッシュ：半径 0.4 の球体（`SphereGeometry`）
- ビーム：地面から上方向へ 70m の線（`Line`）。`depthTest: true` で建物の背後では隠れる。

---

## 効果詳細

### エネルギー（energy）

- **効果タイプ**: 即時効果（キューに乗らない）
- **回復量**: 25（最大 100 まで）
- 取得した瞬間にエネルギーが回復する。

### 速度Up（speedUp）

- **効果タイプ**: 一時バフ（キューで順番に消費）
- **持続時間**: 30秒
- **効果**: 移動速度が 1.2 倍になる
- 加速（W）・減速（S）の倍率にさらに乗算される。

### 回復短縮（recoveryCooldownShort）

- **効果タイプ**: 一時バフ（キューで順番に消費）
- **持続時間**: 45秒
- **効果**: 加速・減速直後の回復クールダウンが 0.5 倍（1.0秒 → 0.5秒）
- より早くエネルギー自動回復が始まる。

---

## バフキューの仕組み

1. **即時効果**（`duration: 0`）はキューに入らず、取得時にすぐ適用される（エネルギー回復など）。
2. **一時バフ**（`duration > 0`）は取得するとキューに追加される。
3. キューは**取った順に 1 つずつ消費**される（FIFO）。
4. 消費中のバフの残り時間が 0 になると、キューの次のバフが消費開始。
5. UI のバフ欄に「消費中バフ」と「待機キュー」が表示される。

---

## スポーン

- 初期配置: ゲーム開始時に 60 個をランダム座標に配置（`main.js`）。
- 種類: スポーン時に `SPAWN_WEIGHTS` に従ってランダム抽選。
- 高さ: 地形の高さに応じて自動調整（`updateFoodHeights`）。

---

## 拡張予定（未実装）

| typeId | 名前 | 効果 | 持続時間 |
|--------|------|------|----------|
| `pickupRangeUp` | 取得範囲Up | 有効取得範囲アップ | 60秒 |
| `attractionUp` | 吸引Up | 吸引率アップ | 40秒 |
| `attackUp` | 攻撃Up | 攻撃力アップ | 50秒 |
| `defenseUp` | 防御Up | 防御力アップ | 50秒 |
| `durationExtend` | 持続延長 | 他バフの持続時間延長 | 20秒 |

追加する場合は以下を編集:

1. `js/buffs.js` の `BUFF_TYPES` に定義を追加
2. `js/food.js` の `FOOD_COLORS` / `FOOD_BEAM_COLORS` / `SPAWN_WEIGHTS` に色と出現率を追加

---

## ソースファイル

| ファイル | 役割 |
|----------|------|
| `js/food.js` | 食べ物の生成・配置・高さ更新。色・出現率の定義。 |
| `js/buffs.js` | バフ種類の定義（`BUFF_TYPES`）、キュー処理、効果計算。 |
| `js/main.js` | 取得判定、バフキュー更新、効果適用。 |
| `js/ui.js` | バフ欄の表示（`updateBuffQueue`）。 |

---

## 定数一覧

| 定数 | 値 | 場所 | 説明 |
|------|-----|------|------|
| `collectRadius` | 2.5 | food.js | 取得判定の半径（m） |
| `energyPerFood` | 25 | food.js | energy タイプの回復量 |
| `beamHeight` | 70 | food.js | ビームの高さ（m） |
| `recoveryCooldownSec` | 1.0 | player.js | 回復クールダウンのベース値（秒） |
