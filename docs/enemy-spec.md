# 敵システム仕様書

## 1. 概要

プレイヤーを追いかけて攻撃してくる敵システム。雑魚敵とライバルの2種類が存在。

---

## 2. 敵の種類

### 2.1 雑魚敵

| パラメータ | 値 | 備考 |
|-----------|-----|------|
| スポーン間隔 | 60秒 | 初回は30秒後 |
| 最大同時存在数 | 10体 | |
| 基本HP | 50 × 強さ係数 | 強さ係数: 0.5〜0.9 |
| 基本攻撃力 | 5 × 強さ係数 | |
| 移動速度 | 8 × (0.8〜1.2) | ランダム幅あり |
| 攻撃クールダウン | 1.5秒 | |
| 所持マスク | 1〜3個 | 強さに応じて増加 |
| スポーン位置 | プレイヤーから30〜80m | ランダム方向 |

### 2.2 ライバル

| パラメータ | 値 | 備考 |
|-----------|-----|------|
| スポーン間隔 | 15分ごと | |
| 最大同時存在数 | 1体 | |
| HP | 100 | |
| 攻撃力 | 雑魚の3倍 | |
| 移動速度 | 雑魚と同等 | |
| 所持マスク | 5個 | |
| 特殊演出 | 出現時に警告表示 | |

---

## 3. 敵の行動

### 3.1 追跡 AI

```
1. プレイヤーとの距離を計算
2. 近くにドロップマスクがあるか確認
   - マスクがプレイヤーより近い場合 → マスクを優先追跡
   - それ以外 → プレイヤーを追跡
3. 追跡範囲内（100m以内）かつ攻撃範囲外（5m超）なら移動
4. 攻撃範囲内（5m以内）なら攻撃
```

### 3.2 マスク拾得

- **拾得範囲**: 5m
- **対象**: プレイヤーがドロップしたマスク
- **効果**: マスクを拾うと敵が強化される
  - 赤マスク: 攻撃力 +5%
  - 青マスク: 最大HP +5% & HP回復
  - 緑マスク: 移動速度 +5%
  - その他: 攻撃力 +2.5%

### 3.3 攻撃

- **攻撃範囲**: 5m
- **攻撃クールダウン**: 1.5秒
- **ダメージ計算**: `攻撃力 × (1 - プレイヤー防御 × 0.5)`
- **発動条件**: プレイヤーが攻撃範囲内にいる

---

## 4. 敵の見た目

### 4.1 3Dモデル構成

```
敵（THREE.Group）
├── 胴体（CapsuleGeometry）
├── 頭部（SphereGeometry）
├── マスク（PlaneGeometry）← 顔の前面、所持マスクの色
├── 追加マスク（CircleGeometry）← 頭上に表示、複数所持時
├── 左腕（CapsuleGeometry）
├── 右腕（CapsuleGeometry）
├── 左足（CapsuleGeometry）
├── 右足（CapsuleGeometry）
└── 体力ゲージ（Group）← 頭上に表示
```

### 4.2 色

- **胴体・腕・足**: 所持マスクの主色（暗め）
- **頭部**: 肌色（#ffddbb）
- **マスク**: 所持マスクの色（発光あり）

### 4.3 体力ゲージ

- **位置**: 敵の頭上（Y +3.2）
- **サイズ**: 幅1.2、高さ0.15
- **色**:
  - HP 50%以上: 緑（#44ff44）
  - HP 25〜50%: 黄（#ffff44）
  - HP 25%未満: 赤（#ff4444）

---

## 5. 戦闘システム

### 5.1 プレイヤーの攻撃

| パラメータ | 値 |
|-----------|-----|
| 攻撃範囲 | 6m |
| 基本攻撃力 | 10 |
| 攻撃クールダウン | 0.8秒 |
| ダメージ幅 | ±20% |

### 5.2 ダメージ計算式

```
ダメージ = (基本攻撃力 + 成長攻撃力) × (1 + 攻撃倍率) - 防御力 × 0.5
最終ダメージ = ダメージ × (0.8〜1.2)  // ランダム
```

### 5.3 攻撃倍率の構成

- **マスク効果**: 赤マスクから +5% × レベル
- **装備効果**: 武器などから加算
- **バフ効果**: 攻撃Upバフから加算

---

## 6. 死亡・ドロップ

### 6.1 死亡アニメーション

- **縮小**: 0.5秒かけて消滅
- **落下**: 同時に下方向に移動

### 6.2 マスクドロップ

- 所持している全マスクをドロップ
- マスクは光の柱付きで表示
- プレイヤーまたは他の敵が回収可能

---

## 7. マスクシステム

### 7.1 マスクの種類

| ID | 名前 | 色 | 効果 | 基本値 |
|----|------|-----|------|--------|
| red | 赤マスク | #ff4444 | 攻撃力 | +5% |
| blue | 青マスク | #4444ff | 防御力 | +5% |
| green | 緑マスク | #44ff44 | 速度 | +5% |
| yellow | 黄マスク | #ffff44 | 取得範囲 | +10% |
| purple | 紫マスク | #ff44ff | 吸引力 | +10% |
| cyan | 水色マスク | #44ffff | 索敵 | +10% |
| orange | 橙マスク | #ff8844 | バフ持続 | +5% |
| white | 白マスク | #ffffff | 全能力 | +2% |

### 7.2 マスク合成

- 同種マスクを回収すると自動合成
- レベルアップで効果増加: `基本値 × (1 + レベル × 0.1)`
- 例: Lv2 = 1.1倍、Lv3 = 1.2倍、Lv10 = 2.0倍

### 7.3 プレイヤーのマスクドロップ

- **条件**: 1回の攻撃でエネルギー25%以上減少
- **ドロップ数**: 1個
- **選択**: ランダム
- **位置**: プレイヤーの現在位置

---

## 8. 定数一覧（js/enemy.js）

```javascript
ENEMY_CONFIG = {
  spawnIntervalSec: 60,    // スポーン間隔（秒）
  maxEnemies: 10,          // 最大敵数
  chaseRange: 100,         // 追跡開始距離
  attackRange: 5,          // 攻撃範囲
  baseSpeed: 8,            // 基本移動速度
  baseHp: 50,              // 基本体力
  baseAttack: 5,           // 基本攻撃力
  attackCooldown: 1.5,     // 攻撃クールダウン（秒）
  minHeight: 26,           // 敵の最低高度
}
```

---

## 9. 今後の拡張予定

### 9.1 敵同士の戦闘

- 雑魚 vs 雑魚
- ライバル vs 雑魚
- 弱い方を優先ターゲット

### 9.2 敵の種類追加

- 遠距離攻撃型
- 高速追尾型
- タンク型（高HP・低速度）

### 9.3 ボスパターン

- 特殊攻撃（範囲攻撃など）
- フェーズ変化
- ドロップ報酬増加
